<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link href="/style.css" rel="stylesheet" />
    <title>Tender Details</title>
</head>
<body>

<nav class="navbar">
    <a href="/allTenders" class="navbar-link">All Tenders</a>
</nav>

<h1 id="tender-id-header"></h1>

<h1>Tender</h1>
<table>
    <tr>
        <td>Date</td>
        <td>Deadline Date</td>
        <td>DD Length Date</td>
        <td>Title</td>
        <td>Category</td>
        <td>SID</td>
        <td>Source URL</td>
        <td>Update</td>
        <td>Remove</td>
    </tr>
    <tr id="tender-details"></tr>
</table>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const tenderId = params.get("id");

        if (!tenderId) {
            document.body.innerHTML = "<p>Missing tender ID in URL.</p>";
            return;
        }

        document.getElementById("tender-id-header").textContent = "Tender ID: " + tenderId;

        fetch(`https://tin-web-api.onrender.com/tenders/${tenderId}`)
            .then(response => {
                if (!response.ok) throw new Error("Tender not found");
                return response.json();
            })
            .then(tender => {
                const row = document.getElementById("tender-details");
                row.innerHTML = `
                    <td>${tender.date ?? ''}</td>
                    <td>${tender.deadlineDate ?? '-'}</td>
                    <td>${tender.deadlineLengthDays ?? '-'}</td>
                    <td>${tender.title ?? ''}</td>
                    <td>${tender.category ?? ''}</td>
                    <td>${tender.sid ?? ''}</td>
                    <td><a href="${tender.sourceUrl}" target="_blank">${tender.sourceUrl}</a></td>
                    <td><a href="/updateTender?id=${tender.sourceId}">Update</a></td>
                    <td><a href="/removeTender?id=${tender.sourceId}">Remove</a></td>
                `;
            })
            .catch(err => {
                console.error("Error:", err);
                document.getElementById("tender-details").innerHTML = "<td colspan='9'>Tender not found or server error.</td>";
            });
    });
</script>

</body>
</html>